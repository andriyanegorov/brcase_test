<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BR Admin Ultimate (Supabase Promos)</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { background: #121212; color: #eee; font-family: 'Segoe UI', monospace; padding: 20px; margin: 0; box-sizing: border-box; }
        input, textarea, select { -webkit-user-select: text; user-select: text; }
        h2, h3, h4 { color: #FFD700; margin-top: 0; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .container { display: grid; grid-template-columns: 280px 1fr; gap: 20px; }
        @media (max-width: 800px) { .container { grid-template-columns: 1fr; } }
        
        .sidebar { background: #1e1e1e; padding: 15px; border: 1px solid #333; border-radius: 8px; height: fit-content; max-height: 80vh; overflow-y: auto; }
        .editor { background: #1e1e1e; padding: 20px; border: 1px solid #333; border-radius: 8px; }
        
        button { cursor: pointer; padding: 10px; border: none; font-weight: bold; width: 100%; margin-bottom: 5px; border-radius: 4px; transition: 0.2s; }
        button:hover { filter: brightness(1.1); }
        
        .btn-green { background: #4CAF50; color: white; }
        .btn-red { background: #ff4d4d; color: white; }
        .btn-gold { background: #FFD700; color: black; }
        .btn-blue { background: #2196F3; color: white; }
        .btn-gray { background: #444; color: #ccc; font-size: 12px; }
        
        .btn-item { background: #2a2a2a; color: white; text-align: left; border-bottom: 1px solid #333; padding: 12px; }
        .btn-item:hover { background: #333; }
        .btn-item.active { background: #FFD700; color: black; border-color: #FFD700; }

        input, select { width: 100%; padding: 10px; margin-bottom: 10px; background: #121212; border: 1px solid #444; color: white; box-sizing: border-box; border-radius: 4px; }
        label { display: block; font-size: 12px; color: #aaa; margin-bottom: 4px; font-weight: bold; }
        
        .items-header { display: grid; grid-template-columns: 50px 2fr 1fr 1.5fr 40px; gap: 10px; padding: 0 10px; font-size: 12px; color: #888; margin-bottom: 5px; }
        .item-row { display: grid; grid-template-columns: 50px 2fr 1fr 1.5fr 40px; gap: 10px; align-items: start; background: #252525; padding: 10px; margin-bottom: 8px; border-left: 4px solid #555; border-radius: 4px; }
        
        .item-row input, .item-row select { margin-bottom: 5px; font-size: 13px; padding: 6px; }
        .item-img-preview { width: 40px; height: 40px; object-fit: contain; background: #000; border-radius: 4px; border: 1px solid #333; pointer-events: none; }
        
        .export-area { width: 100%; height: 120px; background: #080808; color: #0f0; border: 1px solid #333; font-size: 11px; margin-top: 10px; font-family: monospace; padding: 10px; resize: vertical; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: #1e1e1e; padding: 5px; border-radius: 8px; }
        .tab-btn { background: transparent; color: #aaa; flex: 1; padding: 12px; text-align: center; cursor: pointer; border-radius: 6px; font-weight: 600; }
        .tab-btn.active { background: #333; color: #FFD700; }
        
        .chances-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 20px; padding: 15px; background: #181818; border: 1px solid #333; border-radius: 6px; }
        
        .border-consumer { border-left-color: #B0B0B0; }
        .border-common { border-left-color: #4CAF50; }
        .border-rare { border-left-color: #2196F3; }
        .border-epic { border-left-color: #9C27B0; }
        .border-legendary { border-left-color: #FFD700; }
        .border-mythical { border-left-color: #FF0055; }
        
        .promo-row { display: grid; grid-template-columns: 2fr 1fr 1fr 40px; gap: 10px; background: #252525; padding: 10px; margin-bottom: 5px; border-radius: 4px; border-left: 4px solid gold; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h2>‚öôÔ∏è ADMIN PANEL</h2>
            <div style="font-size: 12px; color: #666;">–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Supabase Promos)</div>
        </div>
        <div style="display:flex; gap:10px;">
             <button onclick="resetToDefault()" class="btn-gray" style="width: auto;">‚Ü∫ –°–±—Ä–æ—Å –∫–µ–π—Å–æ–≤</button>
             <button onclick="copyConfig()" class="btn-gold" style="width: auto; padding: 10px 30px;" id="copy-btn">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ CONFIG.JS</button>
        </div>
    </div>

    <div class="tabs">
        <div class="tab-btn active" onclick="setMode('cases')" id="tab-cases">üì¶ –ö–ï–ô–°–´</div>
        <div class="tab-btn" onclick="setMode('promos')" id="tab-promos">üéü –ü–†–û–ú–û–ö–û–î–´ (SUPABASE)</div>
    </div>

    <div class="container" id="view-cases">
        <div class="sidebar">
            <h3 style="margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; color: #666;">–°–ø–∏—Å–æ–∫ –ö–µ–π—Å–æ–≤</h3>
            <div id="cases-list"></div>
            <button class="btn-green" style="margin-top: 10px;" onclick="addNewCase()">+ –ù–æ–≤—ã–π –ö–µ–π—Å</button>
        </div>

        <div class="editor" id="editor-area" style="display:none;">
            <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 20px;">
                <img id="case-img-preview" src="" style="width: 80px; height: 80px; object-fit: contain; background: #111; border: 1px solid #333; border-radius: 8px;">
                <div style="flex: 1;">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–µ–π—Å–∞:</label>
                    <input type="text" id="case-name" oninput="updateCaseMeta()">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <div>
                            <label>–¶–µ–Ω–∞ (‚ÇΩ):</label>
                            <input type="number" id="case-price" oninput="updateCaseMeta()">
                        </div>
                        <div>
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                            <select id="case-category" onchange="updateCaseMeta()">
                                <option value="default">–û–±—ã—á–Ω—ã–µ</option>
                                <option value="bundles">–ù–∞–±–æ—Ä—ã</option>
                                <option value="risk">–í—Å—ë –∏–ª–∏ –ù–∏—á–µ–≥–æ</option>
                                <option value="free">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</option>
                                <option value="container">–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã</option>
                            </select>
                        </div>
                        <div>
                            <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ (URL):</label>
                            <input type="text" id="case-img" oninput="updateCaseMeta()">
                        </div>
                    </div>
                </div>
            </div>

            <h4 style="border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px;">üé≤ –®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è (%)</h4>
            <div class="chances-grid">
                <div><label style="color:#B0B0B0">–®–∏—Ä–ø</label><input type="number" step="0.01" id="chance-consumer" onchange="updateChances()"></div>
                <div><label style="color:#4CAF50">–û–±—ã—á–Ω—ã–π</label><input type="number" step="0.01" id="chance-common" onchange="updateChances()"></div>
                <div><label style="color:#2196F3">–†–µ–¥–∫–∏–π</label><input type="number" step="0.01" id="chance-rare" onchange="updateChances()"></div>
                <div><label style="color:#9C27B0">–≠–ø–∏–∫</label><input type="number" step="0.01" id="chance-epic" onchange="updateChances()"></div>
                <div><label style="color:#FFD700">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</label><input type="number" step="0.01" id="chance-legendary" onchange="updateChances()"></div>
                <div><label style="color:#FF0055">–ú–ò–§–ò–ß–ï–°–ö–ò–ô</label><input type="number" step="0.01" id="chance-mythical" onchange="updateChances()"></div>
            </div>

            <div style="background: #1a1a1a; padding: 10px; border-radius: 8px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h4 style="margin:0;">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞</h4>
                    <button class="btn-green" style="width:auto; font-size:12px;" onclick="addItem()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                </div>
                
                <div class="items-header">
                    <span>IMG</span>
                    <span>–ù–∞–∑–≤–∞–Ω–∏–µ</span>
                    <span>–¶–µ–Ω–∞ (‚ÇΩ)</span>
                    <span>–†–µ–¥–∫–æ—Å—Ç—å</span>
                    <span>Del</span>
                </div>
                <div id="items-container"></div>
            </div>
            
            <button class="btn-red" style="margin-top: 30px;" onclick="deleteCurrentCase()">–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ö–µ–π—Å</button>
        </div>
    </div>

    <div class="container" id="view-promos" style="display:none; grid-template-columns: 1fr;">
        <div class="editor">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –ü—Ä–æ–º–æ–∫–æ–¥—ã (–í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)</h3>
                <button class="btn-blue" style="width:auto; padding: 10px 20px;" onclick="addPromo()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–¥</button>
            </div>
            <div class="items-header" style="grid-template-columns: 2fr 1fr 1fr 40px;">
                <span>–ö–æ–¥ (–ü—Ä–∏–º–µ—Ä: BONUS)</span>
                <span>–°—É–º–º–∞ –Ω–∞–≥—Ä–∞–¥—ã (‚ÇΩ)</span>
                <span>–°—Ç–∞—Ç—É—Å (–í–∫–ª/–í—ã–∫–ª)</span>
                <span>Del</span>
            </div>
            <div id="promos-container">
                <div style="text-align:center; padding: 20px; color:#666;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –∏–∑ –ë–î...</div>
            </div>
        </div>
    </div>

    <div style="margin-top: 30px;" id="export-box">
        <h3 style="font-size: 14px; color: #888;">–ö–æ–¥ –∫–µ–π—Å–æ–≤ (–î–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ script.js):</h3>
        <textarea id="output-json" class="export-area" readonly onclick="this.select()"></textarea>
    </div>

    <script>
        // --- SUPABASE SETUP ---
        const SUPABASE_URL = 'https://itqlqsixknkqoggvubrp.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0cWxxc2l4a25rcW9nZ3Z1YnJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MjE3MDIsImV4cCI6MjA4NjQ5NzcwMn0.mV0As50_W8MBC3kpLYm_mLbExqRRyf8JaJi1eNOtAj4'; 
        const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const STORAGE_KEY_CASES = 'admin_game_config_v7';
        const PLACEHOLDER_IMG = "https://placehold.co/100x100/1a1a1a/ffffff?text=No+Image";

        let gameData = [];
        let promoData = []; // –¢–µ–ø–µ—Ä—å –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î
        let currentCaseIdx = -1;

        async function init() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–µ–π—Å–æ–≤ –∏–∑ LocalStorage
            const savedCases = localStorage.getItem(STORAGE_KEY_CASES);
            if(savedCases && savedCases !== "[]") {
                gameData = JSON.parse(savedCases);
            } else {
                gameData = []; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ - –≤—Å—Ç–∞–≤—å—Ç–µ JSON –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é
            }
            renderCasesList();
            exportConfig();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –∏–∑ –ë–î
            await fetchPromosFromDB();
        }

        // --- –õ–û–ì–ò–ö–ê –ü–†–û–ú–û–ö–û–î–û–í (SUPABASE) ---
        async function fetchPromosFromDB() {
            const { data, error } = await sb.from('admin_promos').select('*').order('id', { ascending: true });
            if (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:", error);
                document.getElementById('promos-container').innerHTML = `<div style="color:red; text-align:center;">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î</div>`;
                return;
            }
            promoData = data || [];
            renderPromos();
        }

        function renderPromos() {
            const container = document.getElementById('promos-container');
            container.innerHTML = '';
            
            if(promoData.length === 0) {
                container.innerHTML = `<div style="text-align:center; padding: 20px; color:#666;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</div>`;
                return;
            }

            promoData.forEach((promo, idx) => {
                const row = document.createElement('div');
                row.className = 'promo-row';
                row.innerHTML = `
                    <input type="text" value="${promo.code}" placeholder="CODE" onchange="updatePromoDB(${idx}, 'code', this.value.toUpperCase())" style="margin:0; font-weight:bold; color:gold; text-transform: uppercase;">
                    <input type="number" value="${promo.reward}" placeholder="–°—É–º–º–∞" onchange="updatePromoDB(${idx}, 'reward', this.value)" style="margin:0;">
                    <select onchange="updatePromoDB(${idx}, 'is_active', this.value === 'true')" style="margin:0; color: ${promo.is_active ? '#4CAF50' : '#ff4d4d'}">
                        <option value="true" ${promo.is_active ? 'selected' : ''}>–í–∫–ª—é—á–µ–Ω (–ê–∫—Ç–∏–≤–µ–Ω)</option>
                        <option value="false" ${!promo.is_active ? 'selected' : ''}>–û—Ç–∫–ª—é—á–µ–Ω</option>
                    </select>
                    <button class="btn-red" style="width:100%; margin:0; padding:8px;" onclick="deletePromoDB(${idx})">üóë</button>
                `;
                container.appendChild(row);
            });
        }

        async function addPromo() {
            const newCode = "NEW_" + Math.floor(Math.random()*1000);
            const { data, error } = await sb.from('admin_promos').insert([{ code: newCode, reward: 50, is_active: true }]).select();
            if (error) {
                alert("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: " + error.message);
                return;
            }
            if (data) {
                promoData.push(data[0]);
                renderPromos();
            }
        }

        async function updatePromoDB(idx, field, val) {
            const promo = promoData[idx];
            
            if(field === 'reward') val = parseInt(val) || 0;
            
            // –õ–æ–∫–∞–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º
            promo[field] = val;
            
            // –í –±–∞–∑–µ –æ–±–Ω–æ–≤–ª—è–µ–º
            const updateObj = {};
            updateObj[field] = val;

            const { error } = await sb.from('admin_promos').update(updateObj).eq('id', promo.id);
            if (error) {
                alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + error.message);
            }
            
            if(field === 'is_active') renderPromos(); // –û–±–Ω–æ–≤–∏—Ç—å —Ü–≤–µ—Ç–∞
        }

        async function deletePromoDB(idx) {
            if(!confirm("–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞–≤—Å–µ–≥–¥–∞?")) return;
            const promo = promoData[idx];
            
            const { error } = await sb.from('admin_promos').delete().eq('id', promo.id);
            if (error) {
                alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: " + error.message);
                return;
            }
            
            promoData.splice(idx, 1);
            renderPromos();
        }

        // --- UI –õ–û–ì–ò–ö–ê –ö–ï–ô–°–û–í ---
        function setMode(mode) {
            document.getElementById('view-cases').style.display = mode === 'cases' ? 'grid' : 'none';
            document.getElementById('view-promos').style.display = mode === 'promos' ? 'grid' : 'none';
            document.getElementById('tab-cases').className = `tab-btn ${mode==='cases'?'active':''}`;
            document.getElementById('tab-promos').className = `tab-btn ${mode==='promos'?'active':''}`;
            document.getElementById('export-box').style.display = mode === 'cases' ? 'block' : 'none';
        }

        function resetToDefault() {
            if(!confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∫–µ–π—Å—ã?")) return;
            localStorage.removeItem(STORAGE_KEY_CASES);
            location.reload();
        }

        function renderCasesList() {
            const list = document.getElementById('cases-list');
            list.innerHTML = '';
            gameData.forEach((c, idx) => {
                const btn = document.createElement('button');
                btn.className = `btn-item ${idx === currentCaseIdx ? 'active' : ''}`;
                btn.innerHTML = `<div style="font-size:14px; font-weight:bold;">${c.name}</div><div style="font-size:11px; color:#888;">${c.price} ‚ÇΩ ‚Ä¢ [${c.category || 'default'}]</div>`;
                btn.onclick = () => selectCase(idx);
                list.appendChild(btn);
            });
        }

        function selectCase(idx) {
            currentCaseIdx = idx;
            renderCasesList();
            const c = gameData[idx];
            
            document.getElementById('editor-area').style.display = 'block';
            document.getElementById('case-name').value = c.name;
            document.getElementById('case-price').value = c.price;
            document.getElementById('case-img').value = c.img;
            document.getElementById('case-category').value = c.category || 'default';
            document.getElementById('case-img-preview').src = c.img;
            document.getElementById('case-img-preview').onerror = function() { this.src = PLACEHOLDER_IMG };
            
            if(!c.chances) c.chances = { consumer: 50, common: 30, rare: 15, epic: 4, legendary: 1, mythical: 0 };
            
            document.getElementById('chance-consumer').value = c.chances.consumer || 0;
            document.getElementById('chance-common').value = c.chances.common || 0;
            document.getElementById('chance-rare').value = c.chances.rare || 0;
            document.getElementById('chance-epic').value = c.chances.epic || 0;
            document.getElementById('chance-legendary').value = c.chances.legendary || 0;
            document.getElementById('chance-mythical').value = c.chances.mythical || 0;

            renderItems(c.items);
        }

        function renderItems(items) {
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            items.forEach((item, idx) => {
                const row = document.createElement('div');
                row.className = `item-row border-${item.rarity}`;
                row.innerHTML = `
                    <img src="${item.img}" class="item-img-preview" onerror="this.src='${PLACEHOLDER_IMG}'">
                    <div>
                        <input type="text" value="${item.name}" onchange="updateItem(${idx}, 'name', this.value)" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                        <input type="text" value="${item.img}" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏" style="font-size:10px; color:#888; margin:0;" onchange="updateItem(${idx}, 'img', this.value)">
                    </div>
                    <input type="number" value="${item.price}" onchange="updateItem(${idx}, 'price', this.value)" placeholder="–¶–µ–Ω–∞">
                    <select onchange="updateItem(${idx}, 'rarity', this.value)">
                        <option value="consumer" ${item.rarity==='consumer'?'selected':''}>–®–∏—Ä–ø (–°–µ—Ä—ã–π)</option>
                        <option value="common" ${item.rarity==='common'?'selected':''}>–û–±—ã—á–Ω—ã–π (–ó–µ–ª–µ–Ω—ã–π)</option>
                        <option value="rare" ${item.rarity==='rare'?'selected':''}>–†–µ–¥–∫–∏–π (–°–∏–Ω–∏–π)</option>
                        <option value="epic" ${item.rarity==='epic'?'selected':''}>–≠–ø–∏–∫ (–§–∏–æ–ª)</option>
                        <option value="legendary" ${item.rarity==='legendary'?'selected':''}>–õ–µ–≥–∞ (–ó–æ–ª–æ—Ç–æ)</option>
                        <option value="mythical" ${item.rarity==='mythical'?'selected':''}>–ú–ò–§ (–ö—Ä–∞—Å–Ω—ã–π)</option>
                    </select>
                    <button class="btn-red" style="width:100%; padding:8px;" onclick="deleteItem(${idx})">üóë</button>
                `;
                container.appendChild(row);
            });
        }

        function updateCaseMeta() {
            if(currentCaseIdx === -1) return;
            gameData[currentCaseIdx].name = document.getElementById('case-name').value;
            gameData[currentCaseIdx].price = parseInt(document.getElementById('case-price').value) || 0;
            gameData[currentCaseIdx].img = document.getElementById('case-img').value;
            gameData[currentCaseIdx].category = document.getElementById('case-category').value;
            document.getElementById('case-img-preview').src = gameData[currentCaseIdx].img;
            renderCasesList(); save();
        }

        function updateChances() {
            if(currentCaseIdx === -1) return;
            gameData[currentCaseIdx].chances = {
                consumer: parseFloat(document.getElementById('chance-consumer').value) || 0,
                common: parseFloat(document.getElementById('chance-common').value) || 0,
                rare: parseFloat(document.getElementById('chance-rare').value) || 0,
                epic: parseFloat(document.getElementById('chance-epic').value) || 0,
                legendary: parseFloat(document.getElementById('chance-legendary').value) || 0,
                mythical: parseFloat(document.getElementById('chance-mythical').value) || 0
            };
            save();
        }

        function updateItem(itemIdx, field, value) {
            if(field === 'price') value = parseInt(value) || 0;
            gameData[currentCaseIdx].items[itemIdx][field] = value;
            if(field === 'rarity') renderItems(gameData[currentCaseIdx].items);
            save();
        }

        function addItem() {
            if(currentCaseIdx === -1) return;
            gameData[currentCaseIdx].items.push({ name: "–ù–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç", price: 100, img: PLACEHOLDER_IMG, rarity: "consumer" });
            renderItems(gameData[currentCaseIdx].items); save();
        }

        function deleteItem(idx) {
            if(!confirm("–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç?")) return;
            gameData[currentCaseIdx].items.splice(idx, 1);
            renderItems(gameData[currentCaseIdx].items); save();
        }

        function addNewCase() {
            gameData.push({ id: Date.now(), name: "–ù–æ–≤—ã–π –ö–µ–π—Å", price: 100, category: "default", img: PLACEHOLDER_IMG, chances: { consumer: 50, common: 30, rare: 15, epic: 4, legendary: 0.92, mythical: 0.08 }, items: [] });
            selectCase(gameData.length - 1); save();
        }

        function deleteCurrentCase() {
            if(!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–µ–π—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é?")) return;
            gameData.splice(currentCaseIdx, 1);
            currentCaseIdx = -1;
            document.getElementById('editor-area').style.display = 'none';
            renderCasesList(); save();
        }

        function save() {
            localStorage.setItem(STORAGE_KEY_CASES, JSON.stringify(gameData));
            exportConfig();
        }

        function exportConfig() {
            const jsonCases = JSON.stringify(gameData, null, 4);
            const str = `/* ==============================================
   –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–í–°–¢–ê–í–ò–¢–¨ –≠–¢–û –í –ù–ê–ß–ê–õ–û SCRIPT.JS)
   ============================================== */
const GAME_CONFIG = ${jsonCases};
`;
            document.getElementById('output-json').value = str;
        }

        function copyConfig() {
            const textarea = document.getElementById('output-json');
            textarea.select();
            if(navigator.clipboard) {
                navigator.clipboard.writeText(textarea.value).then(() => alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!")).catch(() => document.execCommand('copy'));
            } else { document.execCommand('copy'); alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!"); }
        }

        init();
    </script>
</body>
</html>